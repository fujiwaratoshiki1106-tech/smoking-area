<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>åšå¤šé§…è¿‘ãã®å–«ç…™å¯èƒ½åº—ä¸€è¦§</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <h1>åšå¤šé§…ã‚¿ãƒã‚³å¸ã†ãªã‚‰ã“ã“</h1>

  <div class="filters">
    <select id="category-filter">
      <option value="">ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠ</option>
      <option value="ã‚«ãƒ•ã‚§">ã‚«ãƒ•ã‚§</option>
      <option value="å–«èŒ¶åº—">å–«èŒ¶åº—</option>
      <option value="å±…é…’å±‹">å±…é…’å±‹</option>
    </select>
    <select id="smoking-filter">
      <option value="">å–«ç…™å½¢æ…‹ã‚’é¸æŠ</option>
      <option value="å…¨å¸­å–«ç…™å¯">å…¨å¸­å–«ç…™å¯</option>
      <option value="åˆ†ç…™">åˆ†ç…™</option>
      <option value="å–«ç…™ãƒ–ãƒ¼ã‚¹ã‚ã‚Š">å–«ç…™ãƒ–ãƒ¼ã‚¹ã‚ã‚Š</option>
    </select>
  </div>

  <div class="store-list" id="store-list">
    <!-- JSã§åº—èˆ—ãƒ‡ãƒ¼ã‚¿ã‚’æŒ¿å…¥ -->
  </div>

  <script>
    let stores = [];

    async function fetchStoresFromCSV() {
      const response = await fetch('stores.csv');
      const text = await response.text();
      const rows = text.trim().split('\n').map(row => row.split(','));
      const headers = rows[0];
      const data = rows.slice(1).map(row => {
        let obj = {};
        headers.forEach((key, i) => obj[key.trim()] = row[i].trim());
        return obj;
      });
      stores = data;
      renderStores();
    }

    function getSmokingIcon(type) {
      switch (type) {
        case "å…¨å¸­å–«ç…™å¯": return "ğŸš¬";
        case "åˆ†ç…™": return "ğŸš·";
        case "å–«ç…™ãƒ–ãƒ¼ã‚¹ã‚ã‚Š": return "ğŸšªğŸ’¨";
        default: return "â“";
      }
    }

    const storeList = document.getElementById("store-list");
    const categoryFilter = document.getElementById("category-filter");
    const smokingFilter = document.getElementById("smoking-filter");

    function renderStores() {
      const category = categoryFilter.value;
      const smoking = smokingFilter.value;
      const filtered = stores.filter(store => {
        return (!category || store.category === category) &&
               (!smoking || store.smoking === smoking);
      });

      storeList.innerHTML = "";
      filtered.forEach(store => {
        const card = document.createElement("div");
        card.className = "store-card";
        card.innerHTML = `
          <h3>${store.name}<span class="smoking-icon">${getSmokingIcon(store.smoking)}</span></h3>
          <p>ã‚«ãƒ†ã‚´ãƒªï¼š${store.category}</p>
          <p>å–«ç…™å½¢æ…‹ï¼š${store.smoking}</p>
          <p>ä½æ‰€ï¼š${store.address}</p>
          <p><a href="${store.mapUrl}" target="_blank">Google Mapã§è¦‹ã‚‹</a></p>
        `;
        storeList.appendChild(card);
      });
    }

    categoryFilter.addEventListener("change", renderStores);
    smokingFilter.addEventListener("change", renderStores);

    fetchStoresFromCSV();
  </script>
</body>
</html>
